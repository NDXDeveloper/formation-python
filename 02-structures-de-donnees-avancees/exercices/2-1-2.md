```python

# Exercice 2 : Analyse de texte - Solution complÃ¨te

import string
import re
from collections import Counter

# Mots vides franÃ§ais et anglais courants
MOTS_VIDES = {
    'le', 'la', 'les', 'un', 'une', 'des', 'de', 'du', 'et', 'ou', 'est', 'sont',
    'a', 'au', 'aux', 'avec', 'dans', 'par', 'pour', 'sur', 'sous', 'vers',
    'the', 'a', 'an', 'and', 'or', 'is', 'are', 'was', 'were', 'in', 'on',
    'at', 'to', 'for', 'of', 'with', 'by'
}

def nettoyer_texte(texte):
    """
    Nettoie le texte en supprimant la ponctuation et en convertissant en minuscules.

    Args:
        texte (str): Le texte Ã  nettoyer

    Returns:
        str: Le texte nettoyÃ©
    """
    if not texte:
        return ""

    # Convertir en minuscules
    texte = texte.lower()

    # Supprimer la ponctuation (garder les espaces)
    texte = re.sub(r'[^\w\s]', ' ', texte)

    # Supprimer les chiffres isolÃ©s
    texte = re.sub(r'\b\d+\b', '', texte)

    # Remplacer les espaces multiples par un seul espace
    texte = re.sub(r'\s+', ' ', texte)

    # Supprimer les espaces en dÃ©but et fin
    texte = texte.strip()

    return texte

def analyser_texte(texte):
    """
    Analyse un texte et retourne des statistiques sur les mots.

    Args:
        texte (str): Le texte Ã  analyser

    Returns:
        tuple: (dictionnaire_occurrences, set_mots_uniques, liste_mots_tries)
    """
    if not texte or not texte.strip():
        return {}, set(), []

    # Nettoyer le texte
    texte_propre = nettoyer_texte(texte)

    if not texte_propre:
        return {}, set(), []

    # SÃ©parer en mots
    mots = texte_propre.split()

    # Filtrer les mots vides et les mots trop courts
    mots_filtres = [mot for mot in mots
                   if len(mot) >= 2 and mot not in MOTS_VIDES]

    # Compter les occurrences
    occurrences = dict(Counter(mots_filtres))

    # CrÃ©er le set des mots uniques
    mots_uniques = set(mots_filtres)

    # CrÃ©er la liste triÃ©e alphabÃ©tiquement
    mots_tries = sorted(mots_uniques)

    return occurrences, mots_uniques, mots_tries

def afficher_statistiques(occurrences, mots_uniques, mots_tries):
    """
    Affiche les statistiques de maniÃ¨re formatÃ©e.

    Args:
        occurrences (dict): Dictionnaire mot -> nombre d'occurrences
        mots_uniques (set): Set des mots uniques
        mots_tries (list): Liste des mots triÃ©s alphabÃ©tiquement
    """
    if not occurrences:
        print("âŒ Aucune donnÃ©e Ã  analyser.")
        return

    nb_total_mots = sum(occurrences.values())
    nb_mots_uniques = len(mots_uniques)

    print("\n" + "="*50)
    print("           ğŸ“Š ANALYSE DE TEXTE ğŸ“Š")
    print("="*50)

    # Statistiques gÃ©nÃ©rales
    print(f"ğŸ“ Nombre total de mots (filtrÃ©s) : {nb_total_mots}")
    print(f"ğŸ”¤ Nombre de mots uniques : {nb_mots_uniques}")

    if nb_total_mots > 0:
        diversite = (nb_mots_uniques / nb_total_mots) * 100
        print(f"ğŸ“ˆ DiversitÃ© lexicale : {diversite:.1f}%")

    # Longueur moyenne des mots
    if mots_uniques:
        longueur_moyenne = sum(len(mot) for mot in mots_uniques) / len(mots_uniques)
        print(f"ğŸ“ Longueur moyenne des mots : {longueur_moyenne:.1f} caractÃ¨res")

    print()

    # Mots les plus frÃ©quents
    mots_frequents = mots_plus_frequents(occurrences, 10)
    print("ğŸ† Top 10 des mots les plus frÃ©quents :")
    for i, (mot, freq) in enumerate(mots_frequents, 1):
        pourcentage = (freq / nb_total_mots) * 100
        print(f"{i:2d}. {mot:15} : {freq:3d} fois ({pourcentage:4.1f}%)")

    print()

    # Distribution par longueur
    print("ğŸ“Š Distribution par longueur de mot :")
    distribution_longueur = {}
    for mot in mots_uniques:
        longueur = len(mot)
        distribution_longueur[longueur] = distribution_longueur.get(longueur, 0) + 1

    for longueur in sorted(distribution_longueur.keys()):
        count = distribution_longueur[longueur]
        pourcentage = (count / nb_mots_uniques) * 100
        barre = "â–ˆ" * (count // max(1, nb_mots_uniques // 20))
        print(f"{longueur:2d} caractÃ¨res : {count:3d} mots ({pourcentage:4.1f}%) {barre}")

def mots_plus_frequents(occurrences, n=5):
    """
    Retourne les n mots les plus frÃ©quents.

    Args:
        occurrences (dict): Dictionnaire des occurrences
        n (int): Nombre de mots Ã  retourner

    Returns:
        list: Liste de tuples (mot, frÃ©quence) triÃ©e par frÃ©quence dÃ©croissante
    """
    if not occurrences:
        return []

    return sorted(occurrences.items(), key=lambda x: x[1], reverse=True)[:n]

def rechercher_mot(occurrences, mot):
    """
    Recherche un mot spÃ©cifique et affiche sa frÃ©quence.

    Args:
        occurrences (dict): Dictionnaire des occurrences
        mot (str): Mot Ã  rechercher
    """
    if not mot.strip():
        print("âŒ Le mot Ã  rechercher ne peut pas Ãªtre vide.")
        return

    mot = mot.strip().lower()

    print(f"\nğŸ” Recherche du mot '{mot}' :")

    if mot in occurrences:
        freq = occurrences[mot]
        total_mots = sum(occurrences.values())
        pourcentage = (freq / total_mots) * 100
        print(f"âœ… TrouvÃ© : {freq} occurrence{'s' if freq > 1 else ''} ({pourcentage:.1f}%)")

        # Classement du mot
        mots_tries = sorted(occurrences.items(), key=lambda x: x[1], reverse=True)
        rang = next(i for i, (m, _) in enumerate(mots_tries, 1) if m == mot)
        print(f"ğŸ† Rang : {rang}/{len(occurrences)} (par frÃ©quence)")
    else:
        print("âŒ Mot non trouvÃ©.")

        # SuggÃ©rer des mots similaires
        mots_similaires = [m for m in occurrences.keys() if mot in m or m in mot]
        if mots_similaires:
            print("ğŸ’¡ Mots similaires trouvÃ©s :")
            for mot_sim in sorted(mots_similaires)[:5]:
                print(f"   - {mot_sim} ({occurrences[mot_sim]} fois)")

def analyser_phrases(texte):
    """
    Analyse le texte au niveau des phrases.

    Args:
        texte (str): Le texte Ã  analyser

    Returns:
        dict: Statistiques sur les phrases
    """
    if not texte:
        return {"nb_phrases": 0, "mots_par_phrase": []}

    # SÃ©parer en phrases (approximatif)
    phrases = re.split(r'[.!?]+', texte)
    phrases = [phrase.strip() for phrase in phrases if phrase.strip()]

    nb_phrases = len(phrases)
    mots_par_phrase = []

    for phrase in phrases:
        mots = nettoyer_texte(phrase).split()
        mots_par_phrase.append(len(mots))

    stats = {
        "nb_phrases": nb_phrases,
        "mots_par_phrase": mots_par_phrase,
        "mots_moyenne": sum(mots_par_phrase) / max(1, len(mots_par_phrase)),
        "phrase_plus_longue": max(mots_par_phrase) if mots_par_phrase else 0,
        "phrase_plus_courte": min(mots_par_phrase) if mots_par_phrase else 0
    }

    return stats

def analyser_bigrammes(texte, n=10):
    """
    Analyse les bigrammes (paires de mots consÃ©cutifs).

    Args:
        texte (str): Le texte Ã  analyser
        n (int): Nombre de bigrammes Ã  retourner

    Returns:
        list: Liste des bigrammes les plus frÃ©quents
    """
    texte_propre = nettoyer_texte(texte)
    if not texte_propre:
        return []

    mots = texte_propre.split()
    mots_filtres = [mot for mot in mots if len(mot) >= 2 and mot not in MOTS_VIDES]

    if len(mots_filtres) < 2:
        return []

    # CrÃ©er les bigrammes
    bigrammes = []
    for i in range(len(mots_filtres) - 1):
        bigramme = f"{mots_filtres[i]} {mots_filtres[i + 1]}"
        bigrammes.append(bigramme)

    # Compter les occurrences
    compteur_bigrammes = Counter(bigrammes)

    return compteur_bigrammes.most_common(n)

def exporter_resultats(occurrences, nom_fichier="analyse_texte.txt"):
    """
    Exporte les rÃ©sultats vers un fichier texte.

    Args:
        occurrences (dict): Dictionnaire des occurrences
        nom_fichier (str): Nom du fichier de sortie
    """
    try:
        with open(nom_fichier, 'w', encoding='utf-8') as fichier:
            fichier.write("ANALYSE DE TEXTE - RÃ‰SULTATS\n")
            fichier.write("="*40 + "\n\n")

            total_mots = sum(occurrences.values())
            fichier.write(f"Nombre total de mots : {total_mots}\n")
            fichier.write(f"Nombre de mots uniques : {len(occurrences)}\n\n")

            fichier.write("FRÃ‰QUENCES PAR MOT :\n")
            fichier.write("-" * 20 + "\n")

            for mot, freq in sorted(occurrences.items(), key=lambda x: x[1], reverse=True):
                pourcentage = (freq / total_mots) * 100
                fichier.write(f"{mot:20} : {freq:4d} ({pourcentage:5.1f}%)\n")

        print(f"âœ… RÃ©sultats exportÃ©s vers '{nom_fichier}'")
    except Exception as e:
        print(f"âŒ Erreur lors de l'export : {e}")

def comparer_textes(texte1, texte2):
    """
    Compare deux textes et affiche les diffÃ©rences.

    Args:
        texte1 (str): Premier texte
        texte2 (str): DeuxiÃ¨me texte
    """
    print("\n" + "="*50)
    print("           ğŸ“Š COMPARAISON DE TEXTES ğŸ“Š")
    print("="*50)

    # Analyser les deux textes
    occ1, uniques1, _ = analyser_texte(texte1)
    occ2, uniques2, _ = analyser_texte(texte2)

    if not occ1 and not occ2:
        print("âŒ Aucun texte Ã  analyser.")
        return

    # Statistiques comparatives
    total1 = sum(occ1.values()) if occ1 else 0
    total2 = sum(occ2.values()) if occ2 else 0

    print(f"ğŸ“ Texte 1 : {total1} mots, {len(uniques1)} uniques")
    print(f"ğŸ“ Texte 2 : {total2} mots, {len(uniques2)} uniques")

    # Mots communs
    mots_communs = uniques1 & uniques2
    mots_uniques_1 = uniques1 - uniques2
    mots_uniques_2 = uniques2 - uniques1

    print(f"\nğŸ¤ Mots communs : {len(mots_communs)}")
    if mots_communs:
        print("   ", ", ".join(sorted(list(mots_communs))[:10]))
        if len(mots_communs) > 10:
            print(f"   ... et {len(mots_communs) - 10} autres")

    print(f"ğŸ”¹ Mots uniques au texte 1 : {len(mots_uniques_1)}")
    if mots_uniques_1:
        print("   ", ", ".join(sorted(list(mots_uniques_1))[:10]))

    print(f"ğŸ”¸ Mots uniques au texte 2 : {len(mots_uniques_2)}")
    if mots_uniques_2:
        print("   ", ", ".join(sorted(list(mots_uniques_2))[:10]))

    # SimilaritÃ©
    if uniques1 or uniques2:
        similarite = len(mots_communs) / len(uniques1 | uniques2) * 100
        print(f"\nğŸ“Š SimilaritÃ© lexicale : {similarite:.1f}%")

def interface_saisie_texte():
    """Interface pour saisir un texte."""
    print("\n=== SAISIE DU TEXTE ===")
    print("1. Saisir le texte directement")
    print("2. Charger depuis un fichier")

    choix = input("Choisissez une option (1-2) : ").strip()

    if choix == "1":
        print("\nSaisissez votre texte (tapez 'FIN' sur une ligne vide pour terminer) :")
        lignes = []
        while True:
            ligne = input()
            if ligne.strip().upper() == "FIN":
                break
            lignes.append(ligne)
        return "\n".join(lignes)

    elif choix == "2":
        nom_fichier = input("Nom du fichier : ").strip()
        try:
            with open(nom_fichier, 'r', encoding='utf-8') as fichier:
                contenu = fichier.read()
            print(f"âœ… Fichier '{nom_fichier}' chargÃ© ({len(contenu)} caractÃ¨res)")
            return contenu
        except FileNotFoundError:
            print(f"âŒ Fichier '{nom_fichier}' non trouvÃ©.")
            return ""
        except Exception as e:
            print(f"âŒ Erreur lors de la lecture : {e}")
            return ""

    else:
        print("âŒ Option invalide.")
        return ""

def analyse_avancee(texte):
    """Effectue une analyse avancÃ©e du texte."""
    print("\n" + "="*50)
    print("           ğŸ“Š ANALYSE AVANCÃ‰E ğŸ“Š")
    print("="*50)

    # Analyse des phrases
    stats_phrases = analyser_phrases(texte)
    print(f"ğŸ“„ Nombre de phrases : {stats_phrases['nb_phrases']}")
    if stats_phrases['nb_phrases'] > 0:
        print(f"ğŸ“ Mots par phrase (moyenne) : {stats_phrases['mots_moyenne']:.1f}")
        print(f"ğŸ“ Phrase la plus longue : {stats_phrases['phrase_plus_longue']} mots")
        print(f"ğŸ“ Phrase la plus courte : {stats_phrases['phrase_plus_courte']} mots")

    # Analyse des bigrammes
    bigrammes = analyser_bigrammes(texte, 10)
    if bigrammes:
        print(f"\nğŸ”— Top 10 des bigrammes (paires de mots) :")
        for i, (bigramme, freq) in enumerate(bigrammes, 1):
            print(f"{i:2d}. {bigramme:25} : {freq} fois")

    # Analyse des caractÃ¨res
    print(f"\nğŸ“ Analyse des caractÃ¨res :")
    print(f"   CaractÃ¨res totaux : {len(texte)}")
    print(f"   CaractÃ¨res (sans espaces) : {len(texte.replace(' ', ''))}")
    print(f"   Mots estimÃ©s : {len(texte.split())}")
    print(f"   Lignes : {len(texte.splitlines())}")

def main():
    """Programme principal avec menu interactif."""
    print("ğŸ“Š Bienvenue dans l'analyseur de texte avancÃ©!")

    texte_courant = ""
    resultats_courants = None

    while True:
        print("\n" + "="*60)
        print("              ğŸ“Š ANALYSEUR DE TEXTE ğŸ“Š")
        print("="*60)
        print("1.  ğŸ“ Saisir/Charger un nouveau texte")
        print("2.  ğŸ” Analyser le texte actuel")
        print("3.  ğŸ“Š Afficher les statistiques complÃ¨tes")
        print("4.  ğŸ” Rechercher un mot spÃ©cifique")
        print("5.  ğŸ† Afficher les mots les plus frÃ©quents")
        print("6.  ğŸ“ˆ Analyse avancÃ©e (phrases, bigrammes)")
        print("7.  ğŸ“‹ Exporter les rÃ©sultats")
        print("8.  ğŸ”„ Comparer avec un autre texte")
        print("9.  â„¹ï¸  Afficher le texte actuel")
        print("10. ğŸšª Quitter")
        print("="*60)

        if texte_courant:
            nb_mots = len(texte_courant.split())
            nb_chars = len(texte_courant)
            print(f"ğŸ“„ Texte actuel : {nb_mots} mots, {nb_chars} caractÃ¨res")
        else:
            print("ğŸ“„ Aucun texte chargÃ©")

        choix = input("\nChoisissez une option (1-10) : ").strip()

        try:
            if choix == "1":
                nouveau_texte = interface_saisie_texte()
                if nouveau_texte.strip():
                    texte_courant = nouveau_texte
                    resultats_courants = None
                    print("âœ… Nouveau texte chargÃ©.")
                else:
                    print("âŒ Aucun texte valide saisi.")

            elif choix == "2":
                if not texte_courant.strip():
                    print("âŒ Aucun texte Ã  analyser. Veuillez d'abord charger un texte.")
                    continue

                print("ğŸ”„ Analyse en cours...")
                resultats_courants = analyser_texte(texte_courant)
                occurrences, mots_uniques, mots_tries = resultats_courants

                if occurrences:
                    print(f"âœ… Analyse terminÃ©e : {len(mots_uniques)} mots uniques trouvÃ©s.")
                else:
                    print("âŒ Aucun mot valide trouvÃ© aprÃ¨s nettoyage.")

            elif choix == "3":
                if not resultats_courants:
                    print("âŒ Veuillez d'abord analyser un texte (option 2).")
                    continue

                occurrences, mots_uniques, mots_tries = resultats_courants
                afficher_statistiques(occurrences, mots_uniques, mots_tries)

            elif choix == "4":
                if not resultats_courants:
                    print("âŒ Veuillez d'abord analyser un texte (option 2).")
                    continue

                mot = input("Mot Ã  rechercher : ").strip()
                occurrences, _, _ = resultats_courants
                rechercher_mot(occurrences, mot)

            elif choix == "5":
                if not resultats_courants:
                    print("âŒ Veuillez d'abord analyser un texte (option 2).")
                    continue

                try:
                    n = int(input("Nombre de mots Ã  afficher (dÃ©faut: 10) : ") or "10")
                    n = max(1, min(n, 50))  # Limiter entre 1 et 50
                except ValueError:
                    n = 10

                occurrences, _, _ = resultats_courants
                mots_freq = mots_plus_frequents(occurrences, n)

                print(f"\nğŸ† Top {len(mots_freq)} des mots les plus frÃ©quents :")
                total = sum(occurrences.values())
                for i, (mot, freq) in enumerate(mots_freq, 1):
                    pourcentage = (freq / total) * 100
                    print(f"{i:2d}. {mot:20} : {freq:3d} fois ({pourcentage:4.1f}%)")

            elif choix == "6":
                if not texte_courant.strip():
                    print("âŒ Aucun texte Ã  analyser.")
                    continue

                analyse_avancee(texte_courant)

            elif choix == "7":
                if not resultats_courants:
                    print("âŒ Veuillez d'abord analyser un texte (option 2).")
                    continue

                nom_fichier = input("Nom du fichier (dÃ©faut: analyse_texte.txt) : ").strip()
                if not nom_fichier:
                    nom_fichier = "analyse_texte.txt"

                occurrences, _, _ = resultats_courants
                exporter_resultats(occurrences, nom_fichier)

            elif choix == "8":
                if not texte_courant.strip():
                    print("âŒ Aucun texte de rÃ©fÃ©rence chargÃ©.")
                    continue

                print("Chargement du deuxiÃ¨me texte pour comparaison :")
                texte2 = interface_saisie_texte()
                if texte2.strip():
                    comparer_textes(texte_courant, texte2)
                else:
                    print("âŒ DeuxiÃ¨me texte invalide.")

            elif choix == "9":
                if not texte_courant.strip():
                    print("âŒ Aucun texte chargÃ©.")
                    continue

                print("\n" + "="*50)
                print("           ğŸ“„ TEXTE ACTUEL ğŸ“„")
                print("="*50)

                # Afficher un aperÃ§u du texte
                if len(texte_courant) <= 500:
                    print(texte_courant)
                else:
                    print(texte_courant[:500] + "...")
                    print(f"\n[AperÃ§u des 500 premiers caractÃ¨res sur {len(texte_courant)} total]")

            elif choix == "10":
                print("ğŸ“Š Merci d'avoir utilisÃ© l'analyseur de texte!")
                print("Ã€ bientÃ´t! ğŸ‘‹")
                break

            else:
                print("âŒ Option invalide. Veuillez choisir entre 1 et 10.")

        except KeyboardInterrupt:
            print("\n\nğŸ›‘ Programme interrompu par l'utilisateur.")
            break
        except Exception as e:
            print(f"âŒ Une erreur inattendue s'est produite : {e}")
            print("Veuillez rÃ©essayer.")

        # Pause pour lire les rÃ©sultats
        if choix in ["2", "3", "4", "5", "6", "8", "9"]:
            input("\nAppuyez sur EntrÃ©e pour continuer...")

# Tests automatiques
def tests_unitaires():
    """Tests pour vÃ©rifier le bon fonctionnement des fonctions."""
    print("ğŸ§ª ExÃ©cution des tests unitaires...")

    # Test 1: Texte simple
    texte_test = "Le chat mange. Le chat dort. Le chien aboie."
    occ, uniques, tries = analyser_texte(texte_test)
    assert "chat" in occ
    assert occ["chat"] == 2
    assert "chien" in uniques
    print("âœ… Test 1 rÃ©ussi : Texte simple")

    # Test 2: Texte vide
    occ, uniques, tries = analyser_texte("")
    assert occ == {}
    assert uniques == set()
    assert tries == []
    print("âœ… Test 2 rÃ©ussi : Texte vide")

    # Test 3: Nettoyage de texte
    texte_sale = "Hello, World! 123 Test... Multiple   spaces."
    texte_propre = nettoyer_texte(texte_sale)
    assert "hello" in texte_propre
    assert "world" in texte_propre
    assert "123" not in texte_propre
    print("âœ… Test 3 rÃ©ussi : Nettoyage de texte")

    # Test 4: Bigrammes
    bigrammes = analyser_bigrammes("python est un langage. python est gÃ©nial.", 5)
    assert any("python est" in bigr for bigr, _ in bigrammes)
    print("âœ… Test 4 rÃ©ussi : Bigrammes")

    print("ğŸ‰ Tous les tests sont passÃ©s avec succÃ¨s!")

if __name__ == "__main__":
    # ExÃ©cuter les tests d'abord
    try:
        tests_unitaires()
        print()
    except Exception as e:
        print(f"âŒ Erreur dans les tests : {e}")
        print()

    # Lancer le programme principal
    main()
```
