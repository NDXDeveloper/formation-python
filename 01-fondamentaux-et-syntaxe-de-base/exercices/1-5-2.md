# Exercice 2 : Lecteur de fichier robuste

## Objectif

CrÃ©er un programme qui lit des fichiers avec une gestion complÃ¨te des erreurs et affiche des statistiques dÃ©taillÃ©es.

## Cahier des charges

1. **Demander le nom d'un fichier** Ã  l'utilisateur
2. **Tenter de le lire** avec gestion d'erreurs complÃ¨te
3. **Afficher des statistiques** (lignes, mots, caractÃ¨res)
4. **GÃ©rer les erreurs** : fichier inexistant, permissions, encodage
5. **Proposer de rÃ©essayer** avec un autre fichier

## Code de base Ã  complÃ©ter

```python
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Exercice 2 : Lecteur de fichier robuste
Module 1.5 - Gestion des erreurs avec try/except
"""

def demander_nom_fichier():
    """
    Demande le nom d'un fichier Ã  l'utilisateur.

    Returns:
        str: Nom du fichier ou None si annulÃ©
    """
    # TODO: ImplÃ©menter la fonction
    pass

def lire_fichier(nom_fichier):
    """
    Lit un fichier avec gestion d'erreurs complÃ¨te.

    Args:
        nom_fichier (str): Nom du fichier Ã  lire

    Returns:
        str: Contenu du fichier ou None en cas d'erreur
    """
    # TODO: ImplÃ©menter la fonction
    pass

def analyser_contenu(contenu):
    """
    Analyse le contenu et retourne des statistiques.

    Args:
        contenu (str): Contenu Ã  analyser

    Returns:
        dict: Dictionnaire avec les statistiques
    """
    # TODO: ImplÃ©menter la fonction
    pass

def afficher_statistiques(stats, nom_fichier):
    """
    Affiche les statistiques du fichier.

    Args:
        stats (dict): Statistiques du fichier
        nom_fichier (str): Nom du fichier
    """
    # TODO: ImplÃ©menter la fonction
    pass

def main():
    """Fonction principale du lecteur de fichier."""
    print("ğŸ“„ === LECTEUR DE FICHIER ROBUSTE ===")

    while True:
        try:
            # TODO: ImplÃ©menter la logique principale
            pass

        except KeyboardInterrupt:
            # TODO: GÃ©rer l'interruption clavier
            pass

        except Exception as e:
            # TODO: GÃ©rer les erreurs inattendues
            pass

if __name__ == "__main__":
    main()
```

## Solution complÃ¨te

```python
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Exercice 2 : Lecteur de fichier robuste - SOLUTION
Module 1.5 - Gestion des erreurs avec try/except
"""

import os
from datetime import datetime

def demander_nom_fichier():
    """
    Demande le nom d'un fichier Ã  l'utilisateur.

    Returns:
        str: Nom du fichier ou None si annulÃ©
    """
    try:
        nom_fichier = input("ğŸ“ Nom du fichier Ã  lire : ").strip()
        if not nom_fichier:
            print("âŒ Le nom de fichier ne peut pas Ãªtre vide")
            return None
        return nom_fichier

    except KeyboardInterrupt:
        print("\nâ¹ï¸ Saisie annulÃ©e")
        return None

def lire_fichier(nom_fichier):
    """
    Lit un fichier avec gestion d'erreurs complÃ¨te.

    Args:
        nom_fichier (str): Nom du fichier Ã  lire

    Returns:
        str: Contenu du fichier ou None en cas d'erreur
    """
    try:
        print(f"ğŸ“– Tentative de lecture du fichier : {nom_fichier}")

        # VÃ©rifier si le fichier existe
        if not os.path.exists(nom_fichier):
            print(f"âŒ Erreur : Le fichier '{nom_fichier}' n'existe pas")
            return None

        # VÃ©rifier si c'est bien un fichier
        if not os.path.isfile(nom_fichier):
            print(f"âŒ Erreur : '{nom_fichier}' n'est pas un fichier")
            return None

        # Tentative de lecture avec diffÃ©rents encodages
        encodages = ['utf-8', 'latin-1', 'cp1252', 'iso-8859-1']

        for encodage in encodages:
            try:
                with open(nom_fichier, 'r', encoding=encodage) as fichier:
                    contenu = fichier.read()
                    print(f"âœ… Fichier lu avec succÃ¨s (encodage : {encodage})")
                    return contenu

            except UnicodeDecodeError:
                continue  # Essayer l'encodage suivant

        # Si aucun encodage n'a fonctionnÃ©
        print("âŒ Erreur : Impossible de dÃ©coder le fichier avec les encodages courants")
        return None

    except FileNotFoundError:
        print(f"âŒ Erreur : Le fichier '{nom_fichier}' est introuvable")
        return None

    except PermissionError:
        print(f"âŒ Erreur : Pas de permission pour lire le fichier '{nom_fichier}'")
        return None

    except OSError as e:
        print(f"âŒ Erreur systÃ¨me : {e}")
        return None

    except Exception as e:
        print(f"âŒ Erreur inattendue lors de la lecture : {e}")
        return None

def analyser_contenu(contenu):
    """
    Analyse le contenu et retourne des statistiques.

    Args:
        contenu (str): Contenu Ã  analyser

    Returns:
        dict: Dictionnaire avec les statistiques
    """
    if not contenu:
        return {
            'caracteres': 0,
            'caracteres_sans_espaces': 0,
            'lignes': 0,
            'lignes_non_vides': 0,
            'mots': 0,
            'paragraphes': 0,
            'voyelles': 0,
            'consonnes': 0,
            'chiffres': 0,
            'ligne_plus_longue': 0,
            'mot_plus_long': ''
        }

    lignes = contenu.split('\n')
    mots = contenu.split()

    # Compter les voyelles et consonnes
    voyelles = 'aeiouAEIOUÃ Ã©Ã¨ÃªÃ«Ã¯Ã®Ã´Ã¶Ã¹Ã»Ã¼Ã¿Ã§'
    nb_voyelles = sum(1 for c in contenu if c in voyelles)
    nb_consonnes = sum(1 for c in contenu if c.isalpha() and c not in voyelles)
    nb_chiffres = sum(1 for c in contenu if c.isdigit())

    # Ligne la plus longue
    ligne_plus_longue = max(len(ligne) for ligne in lignes) if lignes else 0

    # Mot le plus long
    mot_plus_long = max(mots, key=len) if mots else ''

    # Paragraphes (sÃ©parÃ©s par des lignes vides)
    paragraphes = [p.strip() for p in contenu.split('\n\n') if p.strip()]

    return {
        'caracteres': len(contenu),
        'caracteres_sans_espaces': len(contenu.replace(' ', '')),
        'lignes': len(lignes),
        'lignes_non_vides': sum(1 for ligne in lignes if ligne.strip()),
        'mots': len(mots),
        'paragraphes': len(paragraphes),
        'voyelles': nb_voyelles,
        'consonnes': nb_consonnes,
        'chiffres': nb_chiffres,
        'ligne_plus_longue': ligne_plus_longue,
        'mot_plus_long': mot_plus_long
    }

def afficher_statistiques(stats, nom_fichier):
    """
    Affiche les statistiques du fichier.

    Args:
        stats (dict): Statistiques du fichier
        nom_fichier (str): Nom du fichier
    """
    print(f"\nğŸ“Š === STATISTIQUES DE '{nom_fichier}' ===")
    print("â•" * 60)

    # Informations gÃ©nÃ©rales
    print(f"ğŸ“„ Informations gÃ©nÃ©rales :")
    print(f"   â€¢ CaractÃ¨res total      : {stats['caracteres']:,}")
    print(f"   â€¢ CaractÃ¨res (sans espaces) : {stats['caracteres_sans_espaces']:,}")
    print(f"   â€¢ Lignes total          : {stats['lignes']:,}")
    print(f"   â€¢ Lignes non vides      : {stats['lignes_non_vides']:,}")
    print(f"   â€¢ Mots                  : {stats['mots']:,}")
    print(f"   â€¢ Paragraphes           : {stats['paragraphes']:,}")

    # Analyse textuelle
    print(f"\nğŸ”¤ Analyse textuelle :")
    print(f"   â€¢ Voyelles              : {stats['voyelles']:,}")
    print(f"   â€¢ Consonnes             : {stats['consonnes']:,}")
    print(f"   â€¢ Chiffres              : {stats['chiffres']:,}")

    # Records
    print(f"\nğŸ† Records :")
    print(f"   â€¢ Ligne la plus longue  : {stats['ligne_plus_longue']} caractÃ¨res")
    print(f"   â€¢ Mot le plus long      : '{stats['mot_plus_long']}' ({len(stats['mot_plus_long'])} caractÃ¨res)")

    # Moyennes
    if stats['lignes'] > 0:
        moy_car_par_ligne = stats['caracteres'] / stats['lignes']
        print(f"\nğŸ“ˆ Moyennes :")
        print(f"   â€¢ CaractÃ¨res par ligne  : {moy_car_par_ligne:.1f}")

        if stats['mots'] > 0:
            moy_mots_par_ligne = stats['mots'] / stats['lignes_non_vides'] if stats['lignes_non_vides'] > 0 else 0
            moy_car_par_mot = stats['caracteres_sans_espaces'] / stats['mots']
            print(f"   â€¢ Mots par ligne        : {moy_mots_par_ligne:.1f}")
            print(f"   â€¢ CaractÃ¨res par mot    : {moy_car_par_mot:.1f}")

    # Estimation temps de lecture (250 mots/min en moyenne)
    if stats['mots'] > 0:
        temps_lecture = stats['mots'] / 250  # minutes
        print(f"\nâ±ï¸  Temps de lecture estimÃ© : {temps_lecture:.1f} minute(s)")

    print("â•" * 60)

def afficher_apercu(contenu, nom_fichier, nb_lignes=5):
    """
    Affiche un aperÃ§u du dÃ©but du fichier.

    Args:
        contenu (str): Contenu du fichier
        nom_fichier (str): Nom du fichier
        nb_lignes (int): Nombre de lignes Ã  afficher
    """
    if not contenu:
        return

    lignes = contenu.split('\n')

    print(f"\nğŸ‘€ AperÃ§u de '{nom_fichier}' ({nb_lignes} premiÃ¨res lignes) :")
    print("â”€" * 50)

    for i, ligne in enumerate(lignes[:nb_lignes], 1):
        print(f"{i:2d} | {ligne}")

    if len(lignes) > nb_lignes:
        print(f"   | ... ({len(lignes) - nb_lignes} lignes supplÃ©mentaires)")

    print("â”€" * 50)

def main():
    """Fonction principale du lecteur de fichier."""
    print("ğŸ“„ === LECTEUR DE FICHIER ROBUSTE ===")
    print("Ce programme lit des fichiers et affiche des statistiques dÃ©taillÃ©es")

    fichiers_lus = []

    while True:
        try:
            print("\n" + "â”€" * 60)
            print("1. ğŸ“– Lire un nouveau fichier")
            print("2. ğŸ“Š Afficher l'historique des fichiers lus")
            print("3. âŒ Quitter")

            choix = input("\nVotre choix (1-3) : ").strip()

            if choix == "1":
                nom_fichier = demander_nom_fichier()
                if nom_fichier is None:
                    continue

                # Lecture du fichier
                contenu = lire_fichier(nom_fichier)
                if contenu is None:

                    retry = input("ğŸ”„ Voulez-vous essayer un autre fichier ? (o/n) : ").lower()
                    if retry in ['o', 'oui', 'y', 'yes']:
                        continue
                    else:
                        continue

                # Analyse du contenu
                print("ğŸ” Analyse du contenu en cours...")
                stats = analyser_contenu(contenu)

                # Affichage des rÃ©sultats
                afficher_statistiques(stats, nom_fichier)

                # AperÃ§u du fichier
                apercu = input("\nğŸ‘€ Voulez-vous voir un aperÃ§u du fichier ? (o/n) : ").lower()
                if apercu in ['o', 'oui', 'y', 'yes']:
                    try:
                        nb_lignes = int(input("Nombre de lignes Ã  afficher (dÃ©faut: 5) : ") or "5")
                        afficher_apercu(contenu, nom_fichier, nb_lignes)
                    except ValueError:
                        afficher_apercu(contenu, nom_fichier)

                # Ajouter Ã  l'historique
                fichiers_lus.append({
                    'nom': nom_fichier,
                    'timestamp': datetime.now().strftime("%Y-%m-%d %H:%M:%S"),
                    'stats': stats
                })

                print(f"âœ… Fichier '{nom_fichier}' ajoutÃ© Ã  l'historique")

            elif choix == "2":
                if not fichiers_lus:
                    print("ğŸ“­ Aucun fichier lu dans cette session")
                else:
                    print(f"\nğŸ“š Historique des fichiers lus ({len(fichiers_lus)} fichier(s)) :")
                    print("â•" * 80)

                    for i, fichier_info in enumerate(fichiers_lus, 1):
                        stats = fichier_info['stats']
                        print(f"{i}. ğŸ“„ {fichier_info['nom']}")
                        print(f"   â””â”€ Lu le {fichier_info['timestamp']}")
                        print(f"   â””â”€ {stats['lignes']} lignes, {stats['mots']} mots, {stats['caracteres']} caractÃ¨res")
                        print()

                    # Statistiques globales
                    total_caracteres = sum(f['stats']['caracteres'] for f in fichiers_lus)
                    total_mots = sum(f['stats']['mots'] for f in fichiers_lus)
                    total_lignes = sum(f['stats']['lignes'] for f in fichiers_lus)

                    print(f"ğŸ“Š Totaux cumulÃ©s :")
                    print(f"   â€¢ {total_lignes:,} lignes")
                    print(f"   â€¢ {total_mots:,} mots")
                    print(f"   â€¢ {total_caracteres:,} caractÃ¨res")
                    print("â•" * 80)

            elif choix == "3":
                if fichiers_lus:
                    print(f"\nğŸ“‹ RÃ©sumÃ© de la session :")
                    print(f"   â€¢ {len(fichiers_lus)} fichier(s) lu(s)")
                    total_caracteres = sum(f['stats']['caracteres'] for f in fichiers_lus)
                    print(f"   â€¢ {total_caracteres:,} caractÃ¨res traitÃ©s au total")

                print("\nğŸ‘‹ Merci d'avoir utilisÃ© le lecteur de fichier !")
                print("Ã€ bientÃ´t ! ğŸ“š")
                break

            else:
                print("âŒ Choix invalide. Veuillez entrer un nombre entre 1 et 3.")

        except KeyboardInterrupt:
            print(f"\n\nâ¹ï¸ Programme interrompu par l'utilisateur")
            if fichiers_lus:
                print(f"ğŸ“š Fichiers lus dans cette session : {len(fichiers_lus)}")
            print("ğŸ‘‹ Au revoir !")
            break

        except Exception as e:
            print(f"âŒ Erreur inattendue dans le menu : {e}")
            print("ğŸ”„ Retour au menu principal...")

if __name__ == "__main__":
    main()
```

## Tests Ã  effectuer

1. **Fichier existant** : CrÃ©er un fichier texte et le lire
2. **Fichier inexistant** : Essayer de lire un fichier qui n'existe pas
3. **Fichier sans permissions** : Tester avec un fichier protÃ©gÃ©
4. **Fichier avec diffÃ©rents encodages** : UTF-8, Latin-1, etc.
5. **Fichier vide** : CrÃ©er un fichier vide
6. **Fichier trÃ¨s long** : Tester les performances
7. **Interruption clavier** : Ctrl+C pendant la saisie
8. **CaractÃ¨res spÃ©ciaux** : Accents, symboles, etc.

## CritÃ¨res d'Ã©valuation

- âœ… **Gestion d'erreurs complÃ¨te** : FileNotFoundError, PermissionError, UnicodeDecodeError
- âœ… **Statistiques dÃ©taillÃ©es** : Lignes, mots, caractÃ¨res, voyelles, etc.
- âœ… **Interface utilisateur claire** : Messages explicites et menus
- âœ… **Gestion d'encodages** : Tentative avec plusieurs encodages
- âœ… **Historique fonctionnel** : Stockage et affichage des fichiers lus
- âœ… **AperÃ§u de fichier** : Affichage des premiÃ¨res lignes
- âœ… **Code propre** : Fonctions bien organisÃ©es et documentÃ©es

## Extensions possibles

- Recherche de mots-clÃ©s dans le fichier
- Comparaison entre plusieurs fichiers
- Export des statistiques vers un fichier
- Support d'autres formats (CSV, HTML basic)
- DÃ©tection automatique du type de fichier
